<script>
document.addEventListener("DOMContentLoaded", function () {
  if (window.innerWidth >= 769) {
    const main = document.querySelector("main.content.cm-s-obsidian");
    if (!main) return;
    if (main.classList.contains("two-column-layout")) return;

    const mainColumn = document.createElement("div");
    mainColumn.className = "main-column";

    const sidebarColumn = document.createElement("aside");
    sidebarColumn.className = "sidebar-column";

    // Collect all <p> elements that contain <strong>
    const strongParagraphs = Array.from(main.querySelectorAll("p")).filter(p =>
      p.querySelector("strong")
    );

    // Function to find blocks starting with "Description" and ending with "Date"
    function findDescriptionBlocks(paragraphs) {
      const blocks = [];
      let block = [];
      let insideBlock = false;

      paragraphs.forEach(p => {
        const text = p.textContent.trim();

        if (!insideBlock && text.includes("Description")) {
          insideBlock = true;
          block = [p];
        } else if (insideBlock) {
          block.push(p);
          if (text.includes("Date")) {
            blocks.push(...block);
            insideBlock = false;
            block = [];
          }
        }
      });

      return blocks;
    }

    // Get the meta info paragraphs based on your rule
    const metaInfoBlocks = findDescriptionBlocks(strongParagraphs);

    // Get the button container if exists
    const buttonContainer = main.querySelector(".fake-button-container");

    // Move elements to sidebar if they contain any metaInfo paragraph or are buttonContainer
    Array.from(main.children).forEach(child => {
      // Check if child contains any metaInfo paragraph
      const hasMetaP = Array.from(child.querySelectorAll("p")).some(p => metaInfoBlocks.includes(p));

      if (child === buttonContainer || hasMetaP) {
        sidebarColumn.appendChild(child);
      } else {
        mainColumn.appendChild(child);
      }
    });

    // Clear main and append the two columns
    main.innerHTML = "";
    main.classList.add("two-column-layout");
    main.appendChild(mainColumn);
    main.appendChild(sidebarColumn);
  }
});
</script>

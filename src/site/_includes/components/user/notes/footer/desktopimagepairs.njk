<script>
document.addEventListener("DOMContentLoaded", function () {
  if (window.innerWidth < 769) return;

  const main = document.querySelector("main.content.cm-s-obsidian");
  if (!main) return;

  const images = Array.from(main.querySelectorAll("img"));

  // Helper: check if img is inside a <table>
  function isInsideTable(img) {
    return img.closest("table") !== null;
  }

  // Check if image already has an image-pair-container
  function hasImagePairContainer(img) {
    return img.closest(".image-pair-container") !== null;
  }

  let container = null;
  const containers = []; // Keep track of all containers created

  images.forEach((img) => {
    if (isInsideTable(img)) return;  // Skip images inside tables
    if (hasImagePairContainer(img)) return;  // Skip images that already have a container

    if (!container || container.children.length >= 2) {
      // Create a new container for image pairs
      container = document.createElement("div");
      container.className = "image-pair-container";
      img.parentElement.insertBefore(container, img);
      containers.push(container);
    }

    // Append the image to the container
    container.appendChild(img);
  });

  // After grouping, check containers with only one image and center them
  containers.forEach((cont) => {
    if (cont.children.length === 1) {
      cont.classList.add("single-image-centered");
    }
  });

  // Center images that do not have a container
  images.forEach((img) => {
    if (!hasImagePairContainer(img) && !isInsideTable(img)) {
      img.style.display = 'block';
      img.style.marginLeft = 'auto';
      img.style.marginRight = 'auto';
    }
  });
});
</script>
